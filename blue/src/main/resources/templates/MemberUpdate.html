<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>회원 수정</title>
</head>
<body>
<h3>회원 수정</h3>
<form action="/member/MemberUpdate" method="post" id="updateForm">
    <label>수정할 회원 선택: </label>
    <select id="memberSelect" name="memberNum">
        <option value="">회원을 선택하세요</option>
    </select><br>

    <h3>변경 내용</h3>
    <label>회원명 : </label><input type="text" name="nm" id="nm" readonly><br>
    <label>아이디 : </label><input type="text" name="id" id="id" readonly><br>
    <label>비밀번호 : </label><input type="password" name="pw" id="pw"><br>
    <label>이메일 : </label><input type="text" name="email" id="email"><br>
    <label>전화번호 : </label><input type="text" name="phoneNum" id="phoneNum"><br>
    <label>주소 : </label><input type="text" name="address" id="address"><br>
    <label>메세지 알림 상태 : </label><input type="text" name="msgNotiStatus" id="msgNotiStatus"><br>

    <input type="submit" value="수정하기">
</form>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // 회원 전체 목록을 서버에서 가져와 드롭다운에 채웁니다.
        fetch("/member/ms")
            .then(res => res.json())
            .then(members => {
                const memberSelect = document.getElementById('memberSelect');

                members.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.num;
                    option.textContent = `[${member.id}] ${member.nm}`;
                    option.setAttribute('data-member', JSON.stringify(member)); // 전체 회원 정보를 data 속성에 저장
                    memberSelect.appendChild(option);
                });
            })
            .catch(error => console.error('회원 목록을 가져오는 데 실패했습니다:', error));

        // 드롭다운 목록에서 회원을 선택했을 때 입력 필드를 채우는 이벤트 리스너
        document.getElementById('memberSelect').addEventListener('change', (event) => {
            const selectedOption = event.target.options[event.target.selectedIndex];
            const memberData = JSON.parse(selectedOption.getAttribute('data-member'));

            if (memberData) {
                document.getElementById('nm').value = memberData.nm;
                document.getElementById('id').value = memberData.id;
                document.getElementById('email').value = memberData.email;
                document.getElementById('phoneNum').value = memberData.phoneNum;
                document.getElementById('address').value = memberData.address;
                document.getElementById('msgNotiStatus').value = memberData.msgNotiStatus;
                document.getElementById('pw').value = ''; // 보안을 위해 비밀번호는 빈 칸으로 둡니다.
            } else {
                // '회원을 선택하세요' 옵션일 경우 모든 입력 필드를 초기화합니다.
                document.getElementById('nm').value = '';
                document.getElementById('id').value = '';
                document.getElementById('email').value = '';
                document.getElementById('phoneNum').value = '';
                document.getElementById('address').value = '';
                document.getElementById('msgNotiStatus').value = '';
                document.getElementById('pw').value = '';
            }
        });
    });
</script>
</body>
</html>