<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hulahoopblue.green.usehistory.model.dao.UseHistoryMapper">

    <resultMap id="useHistoryResultMap" type="com.hulahoopblue.green.usehistory.model.dto.UseHistoryDTO">
        <id property="transactionNum" column="transaction_num"/>
        <result property="memberNum" column="member_num"/>
        <result property="phoneNum" column="phone_num"/>
        <result property="categoryCd" column="category_cd"/>
        <result property="merchantNum" column="merchant_num"/>
        <result property="merchantNm" column="merchant_nm"/>
        <result property="brokerage" column="brokerage"/>
        <result property="paymentDateTime" column="payment_date_time"/>
        <result property="useStartDateTime" column="use_start_date_time"/>
        <result property="useEndDateTime" column="use_end_date_time"/>
        <result property="reservationStatus" column="reservation_status"/>
    </resultMap>

    <select id="selectUseHistories" resultMap="useHistoryResultMap">
        SELECT
        uh.transaction_num,
        uh.member_num,
        m.phone_num,  uh.category_cd,
        uh.merchant_num,
        mch.merchant_nm,
        uh.brokerage,
        uh.payment_date_time,
        uh.use_start_date_time,
        uh.use_end_date_time,
        uh.reservation_status
        FROM t_usehistory uh
        LEFT JOIN t_merchant mch ON uh.merchant_num = mch.merchant_num
        LEFT JOIN t_member m ON uh.member_num = m.member_num  WHERE uh.merchant_num = #{merchantNum}
        <if test="startDate != null">
            AND uh.payment_date_time &gt;= #{startDate}
        </if>
        <if test="endDate != null">
            AND uh.payment_date_time &lt;= #{endDate}
        </if>
        ORDER BY uh.payment_date_time DESC
    </select>

</mapper>