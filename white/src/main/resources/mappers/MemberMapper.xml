<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hulahoopblue.white.member.model.dao.MemberMapper">

    <!-- ID로 단일 회원 조회 (로그인용) -->
    <select id="selectMemberById" parameterType="string" resultType="com.hulahoopblue.white.member.model.dto.MemberDTO">
        SELECT
            member_num,
            id,
            pw,
            email,
            nm,
            phone_num,
            address,
            msg_noti_status,
            user_typ AS userTyp
        FROM t_member
        WHERE id = #{id}
    </select>

    <!-- 전체 회원 조회 -->
    <select id="selectAllMembers" resultType="com.hulahoopblue.white.member.model.dto.MemberDTO">
        SELECT
            member_num,
            id,
            nm,
            phone_num,
            email,
            address,
            user_typ AS userTyp
        FROM t_member
    </select>

    <!-- 조건별 회원 조회 (카테고리, 가맹점, 검색어) -->
    <select id="selectMembersByCriteria" resultType="com.hulahoopblue.white.member.model.dto.MemberDTO">
        SELECT
        member_num,
        id,
        nm,
        phone_num,
        email,
        address,
        user_typ AS userTyp
        FROM t_member
        <where>
            <if test="categoryCd != null and categoryCd != ''">
                AND user_typ = #{categoryCd}
            </if>
            <if test="merchantNum != null and merchantNum != ''">
                AND member_num IN (
                SELECT member_num
                FROM t_merchant_member
                WHERE merchant_num = #{merchantNum}
                )
            </if>
            <if test="searchText != null and searchText != ''">
                AND (
                id LIKE CONCAT('%', #{searchText}, '%') OR
                nm LIKE CONCAT('%', #{searchText}, '%') OR
                email LIKE CONCAT('%', #{searchText}, '%') OR
                phone_num LIKE CONCAT('%', #{searchText}, '%')
                )
            </if>
        </where>
    </select>

    <!-- 가맹점 목록 조회 -->
    <select id="selectMerchantList" resultType="com.hulahoopblue.white.merchant.model.dto.MerchantDTO">
        SELECT
            merchant_num,
            merchant_nm
        FROM t_merchant
        ORDER BY merchant_nm
    </select>

    <!-- 회원 카테고리 목록 조회 -->
    <select id="selectCategoryList" resultType="Integer">
        SELECT DISTINCT user_typ
        FROM t_member
        ORDER BY user_typ
    </select>

</mapper>
